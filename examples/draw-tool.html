<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>DrawTool</title>

		<script src="./lib/dat.gui/dat.gui.js"></script>
		<link rel="stylesheet" href="./lib/dat.gui/dat.gui.css" />

		<script src="./lib/mapbox-gl/mapbox-gl.js"></script>
		<link rel="stylesheet" href="./lib/mapbox-gl/mapbox-gl.css" />

		<script src="./lib/turf/turf.js"></script>
		<script src="../dist/mapbox-utils.min.js"></script>
		<link rel="stylesheet" href="../dist/mapbox-utils.css" />

		<script src="./common/mapbox-style.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			body {
				width: 100vw;
				height: 100vh;
			}
			#map-container {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<div id="map-container"></div>
		<script>
			const layers = [
				{
					id: 'mapbox-utils-draw-tool-fill',
					type: 'fill',
					paint: {
						'fill-color': '#3264f6',
						'fill-opacity': [
							'case',
							['==', ['feature-state', 'selected'], true],
							0.5,
							['==', ['get', 'active'], true],
							0.3,
							0.1
						]
					},
					filter: ['==', '$type', 'Polygon']
				},
				{
					id: 'mapbox-utils-draw-tool-line',
					type: 'line',
					paint: {
						'line-color': '#3264f6',
						'line-width': [
							'case',
							['==', ['feature-state', 'selected'], true],
							2,
							['==', ['get', 'active'], true],
							2,
							1
						]
					},
					filter: ['any', ['==', '$type', 'LineString'], ['==', '$type', 'Polygon']]
				},
				{
					id: 'mapbox-utils-draw-tool-point',
					type: 'circle',
					paint: {
						'circle-color': '#fff',
						'circle-stroke-color': '#3264f6',
						'circle-radius': 3,
						'circle-stroke-width': 2
					},
					filter: ['==', '$type', 'Point']
				}
			]

			const gui = new dat.GUI()
			const option = {
				mapStyle: 'Electronic',
				drawMode: MapboxUtils.DrawTool.MODE.DRAW_POINT
			}

			gui
				.add(option, 'mapStyle')
				.options(['Electronic', 'Satellite'])
				.onChange((val) => {
					map.setStyle(mapStyles[option.mapStyle], {
						diff: false
					})
				})
				.name('style')

			gui
				.add(option, 'drawMode')
				.options([
					MapboxUtils.DrawTool.MODE.DRAW_POINT,
					MapboxUtils.DrawTool.MODE.DRAW_LINE,
					MapboxUtils.DrawTool.MODE.DRAW_POLYGON,
					MapboxUtils.DrawTool.MODE.DRAW_RECT,
					MapboxUtils.DrawTool.MODE.DRAW_CIRCLE,
					MapboxUtils.DrawTool.MODE.SELECT,
					MapboxUtils.DrawTool.MODE.MOVE
				])
				.onChange((val) => {
					drawTool.changeMode(val)
				})
				.name('DrawMode')

			const map = new mapboxgl.Map({
				container: 'map-container',
				zoom: 10,
				minZoom: 1,
				maxZoom: 18,
				center: [106.263683, 29.274074],
				style: mapStyles[option.mapStyle]
			})
			const drawTool = new MapboxUtils.DrawTool({ layers })
			drawTool.addTo(map)
			// drawTool.changeMode(MapboxUtils.DrawTool.MODE.DRAW_POINT)
			drawTool.changeMode(option.drawMode)
		</script>
	</body>
</html>
