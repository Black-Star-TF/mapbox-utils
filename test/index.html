<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
		<script
			crossorigin
			src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
		></script>
		<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
		<script src="https://cdn.bootcdn.net/ajax/libs/mapbox-gl/1.13.2/mapbox-gl.min.js"></script>
		<link
			href="https://cdn.bootcdn.net/ajax/libs/mapbox-gl/1.13.2/mapbox-gl.min.css"
			rel="stylesheet"
		/>

		<script src="https://cdn.jsdelivr.net/npm/@turf/turf@7.0.0/turf.min.js"></script>
		<link href="../dist/mapbox-utils.css" rel="stylesheet" />
		<script src="../dist/mapbox-utils.min.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			#root {
				width: 100vw;
				height: 100vh;
			}

			.map-container {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<div id="root"></div>

		<script>
			const mapStyle = {
				version: 8,
				sources: {
					baseMap: {
						type: 'raster',
						tiles: [
							'http://t0.tianditu.gov.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk=793ad40dc6f5250e3d93ef43a204b175'
						],
						tileSize: 256
					},
					baseMapLabel: {
						type: 'raster',
						tiles: [
							'http://t0.tianditu.gov.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk=793ad40dc6f5250e3d93ef43a204b175'
						],
						tileSize: 256
					}
				},
				layers: [
					{
						id: 'baseMap',
						source: 'baseMap',
						type: 'raster',
						minzoom: 0,
						maxzoom: 18,
						paint: {
							'raster-brightness-min': 0.1,
							'raster-brightness-max': 1
						}
					},
					{
						id: 'baseMapLabel',
						source: 'baseMapLabel',
						type: 'raster',
						minzoom: 0,
						maxzoom: 18,
						paint: {
							'raster-brightness-min': 0.1,
							'raster-brightness-max': 1
						}
					}
				]
			}
		</script>

		<script type="text/babel">
			function App() {
				return <MapView />
			}
			function MapView() {
				let map
				const points = turf.randomPoint(100, { bbox: [105, 29, 106, 30] })

				const pointLayer = new MapboxUtils.PointLayer({
					layerPool: {
						default: {
							type: 'circle',
							paint: {
								'circle-color': '#f00'
							}
						},
						highlight: {
							type: 'circle',
							paint: {
								'circle-color': '#0f0'
							}
						},
						cluster: {
							type: 'circle',
							paint: {
								'circle-radius': 20,
								'circle-color': '#ff0'
							}
						}
					},
					layers: ['default'],
					highlightTrigger: 'click',
					highlightLayers: ['highlight'],
					cluster: true,
					clusterLayers: ['cluster'],
					fitBoundsOptions: true
				})
				pointLayer.setData(points)

				pointLayer.on('click', (e) => {
					console.log(e)
				})
				pointLayer.on('cluster-click', (e) => {
					console.log(e)
				})
				// pointLayer.on('mousemove', (e) => {
				// 	console.log(e)
				// })
				// pointLayer.on('mouseleave', (e) => {
				// 	console.log(e)
				// })
				// pointLayer.on('mouseenter', (e) => {
				// 	console.log(e)
				// })
				React.useEffect(() => {
					map = new mapboxgl.Map({
						container: document.getElementById('mapContainer'),
						zoom: 10,
						minZoom: 1,
						maxZoom: 18,
						center: [106.263683, 29.274074],
						style: mapStyle
					})
					map.on('load', () => {
						pointLayer.addTo(map)
					})
				})
				return <div className="map-container" id="mapContainer"></div>
			}
			ReactDOM.render(<App />, document.getElementById('root'))
		</script>
	</body>
</html>
